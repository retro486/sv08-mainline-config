[include fluidd.cfg]
[include KAMP_Settings.cfg]
[include sovol-macros.cfg]
#[include timelapse.cfg] # DONT FORGET TO INSTALL THE TIMELAPSE PLUGIN
[gcode_macro TIMELAPSE_TAKE_FRAME]
# No-op
gcode:

# PLEASE UNCOMMENT THE FILE THAT BEST FITS YOUR CONFIGURATION
# DON'T NEED OR WANT TO USE SOMETHING, DON'T USE (UNCOMMENT) IT

# Configs and menu for the stock lcd screen.
[include options/lcd/*.cfg]

# If you are using the stock probe, keep the following lines as-is.
# If you have an Eddy probe, comment the stock probe and uncomment the eddy, then go read options/probe/eddy.cfg. 
# Also, when using eddy, comment out/remove the [probe] section here in the printer.cfg (don't forget the bottom 'SAVE_CONFIG' block)
# Also, when using Sovol eddy, comment out/remove the [probe] section and adjust [quad_gantry_level] section here in the printer.cfg (don't forget the bottom 'SAVE_CONFIG' block)
# Sovol eddy probe config requires eddy-ng, you will have to modify macros yourself according to eddy-ng instalation guide
#[include options/probe/stock.cfg] # Stock probe, default
[include options/probe/eddy.cfg] # BTT Eddy probe
#[include options/probe/sovol-eddy.cfg] # Sovol eddy probe 
#[include options/probe/tronxy.cfg] # Tronxy TR proximity probe
#[include options/probe/micro.cfg] # Micro touch/CR touch

# Want to use a thermistor in your enclosure? You can use a RPi Pico with a BME280.
# Read the guide at /pico-thermistor/ on how to do this. Once ready you can uncomment the cfg below.
#[include options/thermistor/pico.cfg

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f103xe_36FFD605334D413232591351-if00
restart_method: command     

[mcu extra_mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f103xe_57FF6F064888875424321267-if00
restart_method: command      

[virtual_sdcard]
path: ~/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[printer]
kinematics: corexy           
max_velocity: 700            
max_accel: 40000             
#max_accel_to_decel: 10000 # deprecated
minimum_cruise_ratio: 0.5
max_z_velocity: 20           
max_z_accel: 500             
square_corner_velocity: 5.0 

[stepper_x]
step_pin: PE2
dir_pin: !PE0
enable_pin: !PE3
rotation_distance: 40         
microsteps: 16                
full_steps_per_rotation:200   
endstop_pin: tmc2209_stepper_x: virtual_endstop              
position_min: 0               
position_endstop: 355         
position_max: 355             
homing_speed: 30              
homing_retract_dist: 0        
homing_positive_dir: True     
#--------------------------------------------------------------------
[tmc2209 stepper_x]
uart_pin: PE1
interpolate: True             
run_current: 1.1              
#hold_current: 1.2             
sense_resistor: 0.150         
stealthchop_threshold: 0      
uart_address:3
driver_sgthrs: 70
diag_pin: PE15

[stepper_y]
step_pin: PB8
dir_pin: !PB6
enable_pin: !PB9
rotation_distance: 40         
microsteps: 16                
full_steps_per_rotation:200   
endstop_pin: tmc2209_stepper_y: virtual_endstop              
position_min: 0               
position_endstop: 364         
position_max: 364            
homing_speed: 30              
homing_retract_dist: 0        
homing_positive_dir: true     
#--------------------------------------------------------------------
[tmc2209 stepper_y]
uart_pin: PB7
interpolate: True             
run_current: 1.1              
#hold_current: 1.2             
sense_resistor: 0.150         
stealthchop_threshold: 0      
uart_address:3
driver_sgthrs: 70
diag_pin: PE13 

[stepper_z] #motherboard：Z3 
step_pin:PC0    
dir_pin:PE5    
enable_pin:!PC1    
rotation_distance: 40         
gear_ratio: 80:12             
microsteps: 16                
endstop_pin: probe:z_virtual_endstop           
position_max: 347             
position_min: -7              
#position_endstop: 0
homing_speed: 15.0
homing_retract_dist: 5.0
homing_retract_speed: 15.0
second_homing_speed: 10.0

[tmc2209 stepper_z]
uart_pin: PE6 
interpolate: true             
run_current: 0.55           
#hold_current: 0.58         
sense_resistor: 0.150         
stealthchop_threshold: 999999 
uart_address:3

[stepper_z1] ##motherboard：Z1
step_pin:PD3  
dir_pin:!PD1 
enable_pin:!PD4 
rotation_distance: 40         
gear_ratio: 80:12            
microsteps: 16               

[tmc2209 stepper_z1]
uart_pin:PD2  
interpolate: true             
run_current:  0.55          
#hold_current: 0.58           
sense_resistor: 0.150         
stealthchop_threshold: 999999 
uart_address:3

[stepper_z2] ##motherboard：Z2
step_pin:PD7
dir_pin:PD5   
enable_pin:!PB5
rotation_distance: 40         
gear_ratio: 80:12             
microsteps: 16                

[tmc2209 stepper_z2]
uart_pin:PD6  
interpolate: true             
run_current: 0.55            
#hold_current: 0.58           
sense_resistor: 0.150         
stealthchop_threshold: 999999 
uart_address:3

[stepper_z3] ##motherboard：Z4
step_pin:PD11 
dir_pin:!PD9 
enable_pin:!PD12   
rotation_distance: 40         
gear_ratio: 80:12             
microsteps: 16                

[tmc2209 stepper_z3]
uart_pin:PD10    
interpolate: true            
run_current: 0.55         
#hold_current: 0.58           
sense_resistor: 0.150         
uart_address:3
stealthchop_threshold: 999999 

[thermistor my_thermistor_e]
temperature1:25
resistance1:110000
temperature2:100
resistance2:7008
temperature3:220
resistance3:435

[extruder]
step_pin: extra_mcu:PA8   
dir_pin: extra_mcu:PB8    
enable_pin:!extra_mcu: PB11   
rotation_distance: 6.5 
microsteps: 16                
full_steps_per_rotation: 200 
nozzle_diameter: 0.400        
filament_diameter: 1.75  
max_extrude_only_distance: 150     
max_extrude_cross_section: 5
heater_pin:extra_mcu:PB9  
sensor_type:my_thermistor_e  
pullup_resistor: 11500
sensor_pin: extra_mcu:PA5  
min_temp: 5                  
max_temp: 305                 
max_power: 1.0                
min_extrude_temp: 5
control : pid
pid_kp : 33.838
pid_ki : 5.223
pid_kd : 47.752
pressure_advance: 0.025       
pressure_advance_smooth_time: 0.035    

[tmc2209 extruder]
uart_pin: extra_mcu:PB10  
interpolate: True             
run_current: 0.8           
#hold_current: 0.75             
uart_address:3
sense_resistor: 0.150          

[verify_heater extruder]      
max_error: 120                
check_gain_time:30           
hysteresis: 5                
heating_gain: 2               

[filament_switch_sensor filament_sensor]
pause_on_runout: True
event_delay: 3.0
pause_delay: 0.5
switch_pin: PE9

[thermistor my_thermistor]
temperature1:25
resistance1:100000
temperature2:50
resistance2:18085.4
temperature3:100
resistance3:5362.6

[heater_bed]
heater_pin:PA0
sensor_type: my_thermistor  
sensor_pin: PC5
max_power: 1.0               
min_temp: 5                  
max_temp: 105                
control : pid
pid_kp : 73.571
pid_ki : 1.820
pid_kd : 783.849

[verify_heater heater_bed]      
max_error: 120                
check_gain_time:40           
hysteresis: 5                
heating_gain: 2 

# PLEASE REMOVE THIS WHEN USING EDDY
#[probe]
#z_offset: 0

[probe_pressure]
pin: ^!PE12     
x_offset: 0                  
y_offset: 0
z_offset : 0
speed: 1.0

[quad_gantry_level]          
gantry_corners:              
	-60,-10
	410,420
points:
	36,10
	36,320
	346,320
	346,10
speed: 400                   
horizontal_move_z: 10       # set to 5 for Sovol eddy probe
retry_tolerance: 0.05      
retries: 5                  
max_adjust: 30   # set to 10 for Sovol eddy probe

[multi_pin print_cooling_fan_pins]
pins: extra_mcu:PA7, extra_mcu:PB1

# print/part cooling fan
[fan]
pin: multi_pin:print_cooling_fan_pins
max_power: 1.0

[fan_generic exhaust_fan] # exhaust fan
pin: PA2
max_power: 1.0

# MCU fan, aka noisy boi, is now only enabled when using steppers, extruder, heatbed; 5min timeout
[controller_fan MCU_fan]
pin: PA1
max_power: 1
kick_start_time: 0.5
fan_speed: 1
idle_timeout: 300
heater: extruder, heater_bed
stepper: stepper_x, stepper_y

# Want your fan (host) temperature controlled? Uncomment the next section and comment out the above section, derived from: https://www.reddit.com/r/Sovol/comments/1cqntzu/first_mod_on_my_sv08_noctua_fan_for_the/
# WARNING: Do you have a Noctua 24V 4010 fan (eg. NF-A4x10 24V PWM)? Then this will not work and results in a non-spinning fan.
# In that case you can either use the above 'controller_fan' section or use 'control: watermark' and leave the pid entries commented out.
#[temperature_fan MCU_fan]
#pin: PA1
#kick_start_time: 0.5
#max_power: 1.0
#min_temp: 0
#max_temp: 90
#hardware_pwm: true
#target_temp: 50
#sensor_type: temperature_host # please comment out or remove the [temperature_sensor Host_temp] section if you don't want the temperature shown twice in the interface.
#max_speed: 1.0
#min_speed: 0.1
#control: pid
#pid_Kp: 2.0     ;40
#pid_Ki: 5.0     ;0.2
#pid_Kd: 0.5     ;0.1
#pid_deriv_time: 2.0
#control: watermark # use this control if pid control does not work for your fan

[heater_fan hotend_fan]      
pin: extra_mcu:PA6   
max_power: 1.0               
kick_start_time: 0.5         
heater: extruder             
heater_temp: 50              
tachometer_pin:extra_mcu:PA1
tachometer_ppr: 1
tachometer_poll_interval: 0.0013

[gcode_arcs]                       
resolution: 1.0                    

# Defined as an LED for ease of control
[led main_led]
white_pin:PA3
cycle_time: 0.010
hardware_pwm: False
initial_WHITE: 1.0

[idle_timeout]
gcode: _IDLE_TIMEOUT
timeout: 600


[temperature_sensor mcu_temp]         
sensor_type: temperature_mcu
min_temp:0
max_temp:100

[temperature_sensor Host_temp]     
sensor_type: temperature_host
min_temp: 0
max_temp: 110

[temperature_sensor Toolhead_Temp]
sensor_type: temperature_mcu
sensor_mcu: extra_mcu

[pause_resume]

[exclude_object]

#[adxl345]
#cs_pin:extra_mcu:PB12

#[resonance_tester]
#accel_chip: adxl345
#probe_points:
#    175, 175, 30  # an example175 Y175 Z30
#accel_per_hz:50
#min_freq:1
#max_freq:100
#max_smoothing:0.2
#hz_per_sec:0.5

[input_shaper]
damping_ratio_x: 0.001
damping_ratio_y: 0.001
shaper_type_x = mzv
shaper_freq_x = 35
shaper_type_y = mzv
shaper_freq_y = 35

[axis_twist_compensation]
speed: 50
horizontal_move_z: 5
calibrate_start_x: 30
calibrate_end_x: 320
calibrate_y: 175

[firmware_retraction]
retract_length: 1.0
retract_speed: 30
unretract_extra_length: 0
unretract_speed: 30

[save_variables]
filename = ~/printer_data/config/saved_variables.cfg

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050625:3259168.739,0.090000:3258269.799,0.129375:3257374.728,
#*# 	0.170625:3256457.641,0.210000:3255591.445,0.249375:3254728.300,
#*# 	0.290625:3253844.790,0.330000:3252995.188,0.369375:3252174.937,
#*# 	0.410625:3251306.362,0.450000:3250501.002,0.489375:3249701.789,
#*# 	0.530625:3248865.273,0.570000:3248097.525,0.609375:3247331.028,
#*# 	0.650625:3246537.527,0.690000:3245789.984,0.729375:3245057.054,
#*# 	0.770625:3244289.557,0.810000:3243568.772,0.849375:3242856.653,
#*# 	0.890625:3242129.939,0.930000:3241428.348,0.969375:3240743.000,
#*# 	1.010625:3240008.948,1.050000:3239330.950,1.089375:3238649.143,
#*# 	1.130625:3237948.046,1.170000:3237286.499,1.209375:3236624.948,
#*# 	1.250625:3235935.513,1.290000:3235275.070,1.329375:3234621.620,
#*# 	1.370625:3233929.836,1.410000:3233288.473,1.449375:3232653.469,
#*# 	1.490625:3231979.222,1.530000:3231346.157,1.569375:3230717.490,
#*# 	1.610625:3230050.718,1.650000:3229427.651,1.689375:3228810.904,
#*# 	1.730625:3228168.976,1.770000:3227564.009,1.809375:3226958.163,
#*# 	1.850625:3226336.441,1.890000:3225743.097,1.929375:3225158.590,
#*# 	1.970625:3224550.494,2.010000:3223984.684,2.049375:3223417.321,
#*# 	2.090625:3222841.902,2.130000:3222294.442,2.169375:3221755.318,
#*# 	2.210625:3221191.993,2.250000:3220662.417,2.289375:3220132.853,
#*# 	2.330625:3219588.086,2.370000:3219102.284,2.409375:3218607.016,
#*# 	2.450625:3218092.242,2.490000:3217612.320,2.529375:3217141.456,
#*# 	2.570625:3216639.143,2.610000:3216165.572,2.649375:3215707.165,
#*# 	2.690625:3215234.764,2.730000:3214789.792,2.769375:3214342.350,
#*# 	2.810625:3213884.443,2.850000:3213465.468,2.889375:3213050.322,
#*# 	2.930625:3212616.606,2.970000:3212208.402,3.009375:3211820.222,
#*# 	3.050625:3211396.111,3.090000:3211004.805,3.129375:3210620.656,
#*# 	3.170625:3210225.792,3.210000:3209858.959,3.249375:3209493.019,
#*# 	3.290625:3209120.822,3.330000:3208759.382,3.369375:3208406.578,
#*# 	3.410625:3208042.488,3.450000:3207693.704,3.489375:3207361.658,
#*# 	3.530625:3207004.166,3.570000:3206682.097,3.609375:3206369.308,
#*# 	3.650625:3206045.219,3.690000:3205728.382,3.729375:3205419.688,
#*# 	3.770625:3205098.860,3.810000:3204804.014,3.849375:3204504.733,
#*# 	3.890625:3204208.628,3.930000:3203930.507,3.969375:3203647.138,
#*# 	4.010625:3203365.710,4.050000:3203111.616
#*#
#*# [temperature_probe btt_eddy]
#*# calibration_temp = 49.896009
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.007150, 0.011147, -0.002660, -0.000375, -0.012531, -0.020733, -0.014800, -0.022123, -0.027581, -0.001303, 0.039864, 0.047739, 0.039445, 0.045570, 0.061703
#*# 	0.016888, -0.011177, -0.004408, 0.003119, -0.008908, -0.017546, -0.013008, -0.026225, -0.032158, -0.008477, 0.011147, 0.030731, 0.034194, 0.017391, 0.044239
#*# 	0.031569, 0.020921, 0.028057, 0.032900, 0.013358, 0.000481, 0.002265, -0.014362, -0.017546, 0.007579, 0.008471, 0.032444, 0.052533, 0.040320, 0.091607
#*# 	0.076351, 0.044620, 0.037276, 0.037276, 0.012039, 0.000016, -0.004871, -0.026666, -0.036696, -0.009307, -0.003979, 0.025417, 0.056871, 0.056909, 0.105128
#*# 	0.116841, 0.090758, 0.075501, 0.065622, 0.034232, 0.016034, 0.005366, -0.014800, -0.025310, -0.000876, 0.001800, 0.033319, 0.070847, 0.079306, 0.154422
#*# 	0.189548, 0.139925, 0.107270, 0.091164, 0.055121, 0.027631, 0.018283, -0.004833, -0.019377, 0.009363, 0.013358, 0.043364, 0.088616, 0.099217, 0.172997
#*# 	0.223793, 0.193787, 0.156085, 0.129699, 0.093307, 0.064747, 0.049945, 0.026700, 0.016499, 0.038988, 0.039864, 0.073802, 0.117265, 0.143488, 0.233028
#*# 	0.289928, 0.242095, 0.198030, 0.167087, 0.135471, 0.116839, 0.083111, 0.059953, 0.052114, 0.071696, 0.069084, 0.101768, 0.156489, 0.188292, 0.258930
#*# 	0.285230, 0.260149, 0.225087, 0.197182, 0.155681, 0.129744, 0.107234, 0.084811, 0.077164, 0.092864, 0.096707, 0.134623, 0.186147, 0.218296, 0.287991
#*# 	0.305170, 0.270814, 0.240837, 0.217004, 0.176883, 0.143024, 0.132374, 0.105978, 0.095412, 0.122184, 0.128384, 0.163730, 0.212806, 0.231378, 0.290710
#*# 	0.279751, 0.261796, 0.235892, 0.217895, 0.180646, 0.158270, 0.143024, 0.116374, 0.110632, 0.135047, 0.145270, 0.183236, 0.223389, 0.240011, 0.311443
#*# 	0.275921, 0.245353, 0.222496, 0.206469, 0.178988, 0.154831, 0.149260, 0.129701, 0.124856, 0.153982, 0.160737, 0.192937, 0.227186, 0.235892, 0.303562
#*# 	0.237542, 0.230534, 0.211111, 0.200576, 0.174782, 0.156530, 0.155640, 0.142598, 0.141749, 0.168382, 0.173844, 0.201822, 0.237584, 0.246609, 0.328461
#*# 	0.215755, 0.196335, 0.182345, 0.180242, 0.163285, 0.152728, 0.162435, 0.153982, 0.153575, 0.181537, 0.188292, 0.214905, 0.250341, 0.257283, 0.318285
#*# 	0.175547, 0.167977, 0.155235, 0.158188, 0.146628, 0.147052, 0.171779, 0.177249, 0.181496, 0.214905, 0.222544, 0.251901, 0.285642, 0.289144, 0.337738
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.5
#*# min_x = 15.0
#*# max_x = 334.90000000000003
#*# min_y = 18.0
#*# max_y = 334.95999999999987
#*#
#*# [axis_twist_compensation]
#*# z_compensations = 0.010179, -0.018342, 0.008163
#*# compensation_start_x = 30.0
#*# compensation_end_x = 320.0
